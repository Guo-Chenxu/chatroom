设计一个即时聊天程序，包括客户端应用程序和服务器端后台程序。客户端在图形用户界面窗口上完成一下功能：

1. 用户注册：选择新用户注册提交用户名和密码注册新用户，用户名**规定为 6-20 位的数字、字母和下划线**，密码同用户名要求。如果有**同名账户禁止注册**。
2. 用户登录：选择用户登录，输入用户名和密码，系统检查通过则进入聊天系统，否则提示错误返回登录界面。
3. 用户列表显示：**选择这个菜单**以后显示所有用户信息。
4. 添加好友：在用户列表中选择用户发送添加好友请求，对方收到提示**确认后**可以成为好友。
5. 两位好友聊天：不同用户在不同机器上运行本程序并登录互为好友的账户，互相聊天。如果一方不在线，则另外一方发起通信时**显示不在线**，并且信息会在对方上线后送达。
6. 用户暂时不要求建立群聊，但将来很可能要求实现的功能：
    1. 群主建立群聊，至少拉入一个好友用户。然后群中任何一个人都可以拉入自己的好友入群。群中用户也可以在参加的群中找到各个参与的群聊，可以选择退出群聊。
    2. 群组聊天：一位用户在群中发言，所有其它在线用户都能收到，不在线用户上线后能看到最近 7 天的历史信息（过期不必保存）。
7. 需求变更：
    1. 实现聊天漫游功能，用户可以在多个不同客户端（或者说设备上）登录，都能收到历史信息。但同时只能有一个设备登录，或者说新设备上线就将旧设备强制下线。
    2. 增加刷脸身份认证方式。
    3. 群组聊天分等级，每个等级有不同人数上限。

问题解决方法:

1. 正则判断即可, 同名用户加个判断就行
2. 无
3. 似乎没必要
4. 单建一张表存储好友请求的信息, 接收方收到后先弹出提示框, 如果同意则返回发送 true, 双方添加好友成功, 否则返回 false, 没有逻辑处理
5. 发消息的时候获取一下对方状态, 如果对方不在线那就弹一个提示框即可, 每个用户上线以后申请获取一下离线消息和好友申请的信息, 然后弄个弹窗之类的提醒一下(可以仿造 QQ, 但是难度应该有点大)
6. 这是大活~~感觉有点异想天开~~
    1. 建立群聊是一个按钮, 然后可以选择好友建群, 那似乎需要再加两张表, _群聊消息表和群与用户对应表_(又是经典多对多了), 拉好友入群应该也需要一个确认的反馈
    2. 这个逻辑应该和 5 的差不多, 历史消息这个判断一下就行问题不大
7. 怎么还能加需求啊:
    1. 聊天信息都存数据库了, 所以已经实现了聊天漫游, 同时一个设备登录这个也已经实现了
    2. 刷脸 ??? 没思路, 目前找到的都是网页端 + springboot, 但是 springboot + swing 又不会 (数据库里面加一个用户的脸的数据, 前端获取到以后在服务端进行匹配, 但是想法很好, 但并不会)
    3. 群组等级字段, 每次群聊加人的时候判断一下即可
    4. 拉人入群的的群成员是一个列表, json 化成字符串以后放在 content 里面
8. 新问题 (都是未知或者解决不了的问题):
    1. 两个电脑上就没办法拉取消息记录 (疑似是 maven 的问题, 装了 maven 之后就好了) (但是如果双方之前没有聊天记录的话似乎还是有问题) (已解决)
    2. 两个电脑上同样没办法发送下线的消息, 不知道是检测不到窗口关闭还是消息发不出去(感觉像是后者) (似乎又没有问题了, 所以到底是什么问题 啊啊啊!!!)(似乎又没问题了)
    3. 异常退出以后要发送下线消息
    4. 服务端关闭没办法正常关闭(返回代码为 130)

可以优化的点:

1. 客户端也需要存一份聊天数据, 服务端只存近期数据 (来自某大神言论: 一款聊天软件把所有的聊天记录都存在服务端是不可接受的!) (同样来自该大神的建议: sqlite)

<font color=RED size=5><b>整个项目最重要的问题: swing !!!</b></font>

**以及都需要学一下 uml, 写报告要用**

群组消息在消息表里面每个人都存一份
用户登陆后服务器主动发送未读消息(包含群组消息和好友消息)
获取完未读消息以后要设置消息为已读

2023-06-10 00:09:46 更新成功
